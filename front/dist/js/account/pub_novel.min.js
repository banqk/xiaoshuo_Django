function PubNovel(){}PubNovel.prototype.listenUploadFileEvent=function(){$("#thumbnail-btn").change(function(){var e=$(this)[0].files[0],t=new FormData;t.append("file",e),myajax.post({url:"/account/upload_file/",data:t,processData:!1,contentType:!1,success:function(e){if(200===e.code){var t=e.data.url;$("#cover_url-form").val(t)}}})})},PubNovel.prototype.handleFileUploadProgress=function(e){var t=e.total.percent.toFixed(0)+"%";PubNovel.progressGroup.show();var o=PubNovel.progressBar;o.css("width",t),o.text(t)},PubNovel.prototype.handleFileUploadError=function(e){PubNovel.progressGroup.hide(),console.log(result.message)},PubNovel.prototype.handleFileUploadComplete=function(e){PubNovel.progressGroup.hide();var t="http://q0i4557d7.bkt.clouddn.com/"+e.key;$("input[name='thumbnail']").val(t)},PubNovel.prototype.listenQiniuUploadFileEvent=function(){var u=this;$("#thumbnail-btn").change(function(){var r=this.files[0];myajax.get({url:"/cms/qntoken/",success:function(e){if(200===e.code){var t=e.data.token,o=(new Date).getTime()+"."+r.name.split(".")[1],n={fname:o,params:{},mimeType:["image/png","image/jpeg","image/gif","video/mp4"]},a={useCdnDomain:!0,retryCount:6,region:qiniu.region.z1},i=qiniu.upload(r,o,t,n,a),l={next:u.handleFileUploadProgress,error:u.handleFileUploadError,complete:u.handleFileUploadComplete};i.subscribe(l)}}})})},PubNovel.prototype.listenSubmitEvent=function(){$("#submit-btn").click(function(){event.preventDefault();var o=$(this).attr("data-novel-id"),e=$("input[name='name']").val(),t=$("input[name='cover_url']").val(),n=$("select[name='category']").val(),a=$('input[name="tag"]:checked').val(),i=$("input[name='price']").val(),l=window.ue.getContent(),r="";r=o?"/account/edit_novel/":"/account/pub_novel/",myajax.post({url:r,data:{name:e,cover_url:t,category:n,tag:a,profile:l,price:i,novel_id:o},success:function(e){if(200===e.code){var t="";t=o?"恭喜，小说编辑成功！":"恭喜，小说发布成功！",xfzalert.alertSuccess(t,function(){window.location="/account/novel_list/"})}else console.log(e)}})})},PubNovel.prototype.listenIsFreeEvent=function(){var e=$("select[name='is_free']"),t=$("input[name='price']");"1"===e.val()&&t.show(),e.change(function(){"0"===$(this).val()?(t.val(0),t.hide()):"1"===$(this).val()&&(t.val(0),t.show())}),t.change(function(){"0"===$(this).val()&&(e.children().eq(0).prop("selected","selected"),$(this).hide())})},PubNovel.prototype.initUEditor=function(){window.ue=UE.getEditor("editor",{initialFrameHeight:400,serverUrl:"/ueditor/upload/"})},PubNovel.prototype.initCategory=function(){var l=$("#category-form"),r=$(".radio-group");myajax.get({url:"/account/get_cate_list/",success:function(e){if(200===e.code){for(var i=e.data.cate_list,t=0;t<i.length;t++)l.append('<option value="'+i[t].id+'">'+i[t].name+"</option>");for(var o=0;o<i[0].tags.length;o++){var n=$('<label class="radio-inline"></label>'),a=$('<input type="radio" name="tag" value="'+i[0].tags[o].id+'">');n.append(a),n.append(" "+i[0].tags[o].name),r.append(n)}l.change(function(){r.empty();for(var e=$(this).val(),t=i[e-1].tags,o=0;o<t.length;o++){var n=$('<label class="radio-inline"></label>'),a=$('<input type="radio" name="tag" value="'+t[o].id+'">');n.append(a),n.append(" "+t[o].name),r.append(n)}})}}})},PubNovel.prototype.run=function(){this.listenUploadFileEvent(),this.initUEditor(),this.listenSubmitEvent(),this.initCategory(),this.listenIsFreeEvent()},$(function(){(new PubNovel).run(),PubNovel.progressGroup=$("#progress-group"),PubNovel.progressBar=$(".progress-bar")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjY291bnQvcHViX25vdmVsLmpzIl0sIm5hbWVzIjpbIlB1Yk5vdmVsIiwicHJvdG90eXBlIiwibGlzdGVuVXBsb2FkRmlsZUV2ZW50IiwiJCIsImNoYW5nZSIsImZpbGUiLCJ0aGlzIiwiZmlsZXMiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwiYXBwZW5kIiwibXlhamF4IiwicG9zdCIsInVybCIsImRhdGEiLCJwcm9jZXNzRGF0YSIsImNvbnRlbnRUeXBlIiwic3VjY2VzcyIsInJlc3VsdCIsInZhbCIsImhhbmRsZUZpbGVVcGxvYWRQcm9ncmVzcyIsInBlcmNlbnRUZXh0IiwidG90YWwiLCJwZXJjZW50IiwidG9GaXhlZCIsInByb2dyZXNzR3JvdXAiLCJzaG93IiwicHJvZ3Jlc3NCYXIiLCJjc3MiLCJ0ZXh0IiwiaGFuZGxlRmlsZVVwbG9hZEVycm9yIiwiZXJyb3IiLCJoaWRlIiwiY29uc29sZSIsImxvZyIsIm1lc3NhZ2UiLCJoYW5kbGVGaWxlVXBsb2FkQ29tcGxldGUiLCJyZXNwb25zZSIsImtleSIsImxpc3RlblFpbml1VXBsb2FkRmlsZUV2ZW50Iiwic2VsZiIsImdldCIsInRva2VuIiwiRGF0ZSIsImdldFRpbWUiLCJuYW1lIiwic3BsaXQiLCJwdXRFeHRyYSIsImZuYW1lIiwicGFyYW1zIiwibWltZVR5cGUiLCJjb25maWciLCJ1c2VDZG5Eb21haW4iLCJyZXRyeUNvdW50IiwicmVnaW9uIiwicWluaXUiLCJ6MSIsIm9ic2VydmFibGUiLCJ1cGxvYWQiLCJvYnNlcnZlciIsIm5leHQiLCJjb21wbGV0ZSIsInN1YnNjcmliZSIsImxpc3RlblN1Ym1pdEV2ZW50IiwiY2xpY2siLCJldmVudCIsInByZXZlbnREZWZhdWx0Iiwibm92ZWxJZCIsImF0dHIiLCJjb3Zlcl91cmwiLCJjYXRlZ29yeSIsInRhZyIsInByaWNlIiwicHJvZmlsZSIsIndpbmRvdyIsInVlIiwiZ2V0Q29udGVudCIsIm5vdmVsX2lkIiwieGZ6YWxlcnQiLCJhbGVydFN1Y2Nlc3MiLCJsb2NhdGlvbiIsImxpc3RlbklzRnJlZUV2ZW50IiwiaXNGcmVlSW5wdXQiLCJwcmljZUlucHV0IiwiY2hpbGRyZW4iLCJlcSIsInByb3AiLCJpbml0VUVkaXRvciIsIlVFIiwiZ2V0RWRpdG9yIiwiaW5pdGlhbEZyYW1lSGVpZ2h0Iiwic2VydmVyVXJsIiwiaW5pdENhdGVnb3J5Iiwic2VsZWN0IiwicmFkaW9Hcm91cCIsImNhdGVMaXN0IiwiaSIsImxlbmd0aCIsImlkIiwiaiIsImxhYmVsIiwicmVkaW8iLCJlbXB0eSIsImNhdGVnb3J5X2lkIiwidGFncyIsInJ1biJdLCJtYXBwaW5ncyI6IkFBQUEsU0FBU0EsWUFLVEEsU0FBU0MsVUFBVUMsc0JBQXdCLFdBQ3ZCQyxFQUFFLGtCQUNSQyxPQUFPLFdBQ2IsSUFBSUMsRUFBT0YsRUFBRUcsTUFBTSxHQUFHQyxNQUFNLEdBQ3hCQyxFQUFXLElBQUlDLFNBQ25CRCxFQUFTRSxPQUFPLE9BQU9MLEdBQ3ZCTSxPQUFPQyxLQUFLLENBQ1JDLElBQU8sd0JBQ1BDLEtBQVFOLEVBQ1JPLGFBQWUsRUFDZkMsYUFBZSxFQUNmQyxRQUFXLFNBQVNDLEdBQ2hCLEdBQXNCLE1BQW5CQSxFQUFhLEtBQVUsQ0FDdEIsSUFBSUwsRUFBTUssRUFBYSxLQUFPLElBQ1ZmLEVBQUUsbUJBQ1JnQixJQUFJTixVQVF0Q2IsU0FBU0MsVUFBVW1CLHlCQUEyQixTQUFTRixHQUNuRCxJQUVJRyxFQUZRSCxFQUFPSSxNQUNDQyxRQUNNQyxRQUFRLEdBQUssSUFDbkJ4QixTQUFTeUIsY0FDZkMsT0FDZCxJQUFJQyxFQUFjM0IsU0FBUzJCLFlBQzNCQSxFQUFZQyxJQUFJLFFBQVFQLEdBQ3hCTSxFQUFZRSxLQUFLUixJQUlyQnJCLFNBQVNDLFVBQVU2QixzQkFBd0IsU0FBU0MsR0FDNUIvQixTQUFTeUIsY0FDZk8sT0FDZEMsUUFBUUMsSUFBSWhCLE9BQU9pQixVQUl2Qm5DLFNBQVNDLFVBQVVtQyx5QkFBMkIsU0FBU0MsR0FFL0JyQyxTQUFTeUIsY0FDZk8sT0FDZCxJQUVJ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RSxFQUFFLEVBQUVBLEVBQUVELEVBQVNFLE9BQU9ELElBQzFCSCxFQUFPbkYsT0FBTyxrQkFBa0JxRixFQUFTQyxHQUFHRSxHQUFHLEtBQUtILEVBQVNDLEdBQUduRCxLQUFLLGFBR3pFLElBQUksSUFBSXNELEVBQUUsRUFBRUEsRUFBRUosRUFBUyxHQUFTLEtBQUVFLE9BQU9FLElBQUssQ0FDMUMsSUFBSUMsRUFBUWpHLEVBQUUsd0NBQ1ZrRyxFQUFRbEcsRUFBRSx5Q0FBMkM0RixFQUFTLEdBQVMsS0FBRUksR0FBR0QsR0FBSyxNQUNyRkUsRUFBTTFGLE9BQU8yRixHQUNiRCxFQUFNMUYsT0FBTyxJQUFNcUYsRUFBUyxHQUFTLEtBQUVJLEdBQUd0RCxNQUMxQ2lELEVBQVdwRixPQUFPMEYsR0FHdEJQLEVBQU96RixPQUFPLFdBQ1YwRixFQUFXUSxRQUdYLElBRkEsSUFBSUMsRUFBY3BHLEVBQUVHLE1BQU1hLE1BQ3RCcUYsRUFBT1QsRUFBU1EsRUFBWSxHQUFTLEtBQ2pDSixFQUFFLEVBQUVBLEVBQUVLLEVBQUtQLE9BQU9FLElBQUksQ0FDMUIsSUFBSUMsRUFBUWpHLEVBQUUsd0NBQ1ZrRyxFQUFRbEcsRUFBRSx5Q0FBeUNxRyxFQUFLTCxHQUFHRCxHQUFHLE1BQ2xFRSxFQUFNMUYsT0FBTzJGLEdBQ2JELEVBQU0xRixPQUFPLElBQUk4RixFQUFLTCxHQUFHdEQsTUFDekJpRCxFQUFXcEYsT0FBTzBGLFdBUTFDcEcsU0FBU0MsVUFBVXdHLElBQU0sV0FFckJuRyxLQUFLSix3QkFHTEksS0FBS2lGLGNBQ0xqRixLQUFLeUQsb0JBQ0x6RCxLQUFLc0YsZUFDTHRGLEtBQUsyRSxxQkFHVDlFLEVBQUUsWUFDaUIsSUFBSUgsVUFDVnlHLE1BQ1R6RyxTQUFTeUIsY0FBZ0J0QixFQUFFLG1CQUMzQkgsU0FBUzJCLFlBQWN4QixFQUFFIiwiZmlsZSI6ImFjY291bnQvcHViX25vdmVsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIFB1Yk5vdmVsKCl7XHJcblxyXG59XHJcblxyXG4vLyDnm5HlkKzkuIrkvKDlm77niYfkuovku7ZcclxuUHViTm92ZWwucHJvdG90eXBlLmxpc3RlblVwbG9hZEZpbGVFdmVudCA9IGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgdXBsb2FkQnRuID0gJCgnI3RodW1ibmFpbC1idG4nKTsgICAgLy8gaW5wdXRcclxuICAgIHVwbG9hZEJ0bi5jaGFuZ2UoZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgZmlsZSA9ICQodGhpcylbMF0uZmlsZXNbMF07XHJcbiAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlJyxmaWxlKTtcclxuICAgICAgICBteWFqYXgucG9zdCh7XHJcbiAgICAgICAgICAgICd1cmwnOiAnL2FjY291bnQvdXBsb2FkX2ZpbGUvJyxcclxuICAgICAgICAgICAgJ2RhdGEnOiBmb3JtRGF0YSxcclxuICAgICAgICAgICAgJ3Byb2Nlc3NEYXRhJzogZmFsc2UsXHJcbiAgICAgICAgICAgICdjb250ZW50VHlwZSc6IGZhbHNlLFxyXG4gICAgICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICAgICAgICAgICAgICBpZihyZXN1bHRbJ2NvZGUnXSA9PT0gMjAwKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gcmVzdWx0WydkYXRhJ11bJ3VybCddO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb3ZlclVybElucHV0ID0gJCgnI2NvdmVyX3VybC1mb3JtJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY292ZXJVcmxJbnB1dC52YWwodXJsKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH0pXHJcbn07XHJcblxyXG4vLyDlm77niYfkuIrkvKDov4fnqIvkuK1cclxuUHViTm92ZWwucHJvdG90eXBlLmhhbmRsZUZpbGVVcGxvYWRQcm9ncmVzcyA9IGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICB2YXIgdG90YWwgPSByZXN1bHQudG90YWw7XHJcbiAgICB2YXIgcGVyY2VudCA9IHRvdGFsLnBlcmNlbnQ7ICAgIC8vIGludCAg5LiK5Lyg55m+5YiG5q+UXHJcbiAgICB2YXIgcGVyY2VudFRleHQgPSBwZXJjZW50LnRvRml4ZWQoMCkgKyAnJSc7ICAgICAvLyDljrvpmaTlsI/mlbDpg6jliIZcclxuICAgIHZhciBwcm9ncmVzc0dyb3VwID0gUHViTm92ZWwucHJvZ3Jlc3NHcm91cDtcclxuICAgIHByb2dyZXNzR3JvdXAuc2hvdygpO1xyXG4gICAgdmFyIHByb2dyZXNzQmFyID0gUHViTm92ZWwucHJvZ3Jlc3NCYXI7XHJcbiAgICBwcm9ncmVzc0Jhci5jc3MoJ3dpZHRoJyxwZXJjZW50VGV4dCk7XHJcbiAgICBwcm9ncmVzc0Jhci50ZXh0KHBlcmNlbnRUZXh0KVxyXG59O1xyXG5cclxuLy8g5Zu+54mH5LiK5Lyg6ZSZ6K+vXHJcblB1Yk5vdmVsLnByb3RvdHlwZS5oYW5kbGVGaWxlVXBsb2FkRXJyb3IgPSBmdW5jdGlvbihlcnJvcil7XHJcbiAgICB2YXIgcHJvZ3Jlc3NHcm91cCA9IFB1Yk5vdmVsLnByb2dyZXNzR3JvdXA7XHJcbiAgICBwcm9ncmVzc0dyb3VwLmhpZGUoKTtcclxuICAgIGNvbnNvbGUubG9nKHJlc3VsdC5tZXNzYWdlKVxyXG59O1xyXG5cclxuLy8g5Zu+54mH5LiK5Lyg5oiQ5YqfXHJcblB1Yk5vdmVsLnByb3RvdHlwZS5oYW5kbGVGaWxlVXBsb2FkQ29tcGxldGUgPSBmdW5jdGlvbihyZXNwb25zZSl7XHJcbiAgICAvLyByZXNwb25zZTogICAgeyBoYXNoOiAuLi4gLCBrZXk6IC4uLiB9XHJcbiAgICB2YXIgcHJvZ3Jlc3NHcm91cCA9IFB1Yk5vdmVsLnByb2dyZXNzR3JvdXA7XHJcbiAgICBwcm9ncmVzc0dyb3VwLmhpZGUoKTtcclxuICAgIHZhciBkb21haW4gPSAnaHR0cDovL3EwaTQ1NTdkNy5ia3QuY2xvdWRkbi5jb20vJztcclxuICAgIHZhciBmaWxlbmFtZSA9IHJlc3BvbnNlLmtleTtcclxuICAgIHZhciB1cmwgPSBkb21haW4gKyBmaWxlbmFtZTtcclxuICAgIHZhciB0aHVtYm5haWxJbnB1dCA9ICQoXCJpbnB1dFtuYW1lPSd0aHVtYm5haWwnXVwiKTtcclxuICAgIHRodW1ibmFpbElucHV0LnZhbCh1cmwpXHJcbn07XHJcblxyXG4vLyDlsIblm77niYfkuIrkvKDliLDkuIPniZvkupFcclxuUHViTm92ZWwucHJvdG90eXBlLmxpc3RlblFpbml1VXBsb2FkRmlsZUV2ZW50ID0gZnVuY3Rpb24oKXtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciB0aHVtYm5haWxJbnB1dCA9ICQoJyN0aHVtYm5haWwtYnRuJyk7XHJcbiAgICB0aHVtYm5haWxJbnB1dC5jaGFuZ2UoZnVuY3Rpb24oKXtcclxuICAgICAgICAvLyDojrflj5bmlofku7ZcclxuICAgICAgICB2YXIgZmlsZSA9IHRoaXMuZmlsZXNbMF07XHJcbiAgICAgICAgbXlhamF4LmdldCh7XHJcbiAgICAgICAgICAgICd1cmwnOiAnL2Ntcy9xbnRva2VuLycsXHJcbiAgICAgICAgICAgICdzdWNjZXNzJzogZnVuY3Rpb24ocmVzdWx0KXtcclxuICAgICAgICAgICAgICAgIGlmKHJlc3VsdFsnY29kZSddID09PSAyMDApe1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOiOt+WPlnRva2Vu5YC8XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuID0gcmVzdWx0WydkYXRhJ11bJ3Rva2VuJ107XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g6K6+572u5paH5Lu25ZCNXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgKyAnLicgKyBmaWxlLm5hbWUuc3BsaXQoJy4nKVsxXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcHV0RXh0cmEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZuYW1lOiBrZXksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczoge30sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbWVUeXBlOiBbXCJpbWFnZS9wbmdcIixcImltYWdlL2pwZWdcIixcImltYWdlL2dpZlwiLFwidmlkZW8vbXA0XCJdXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VDZG5Eb21haW46dHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0cnlDb3VudDogNixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiBxaW5pdS5yZWdpb24uejEsICAgICAgICAgICAgLy8gejHku6PooajljY7ljJflnLDljLpcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYnNlcnZhYmxlID0gcWluaXUudXBsb2FkKGZpbGUsa2V5LHRva2VuLHB1dEV4dHJhLGNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9ic2VydmVyID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDku6XkuIvlh73mlbDkuK3nmoR0aGlz5LiN5Luj6KGoUHViTm92ZWzlr7nosaFcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQnOiBzZWxmLmhhbmRsZUZpbGVVcGxvYWRQcm9ncmVzcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2Vycm9yJzogc2VsZi5oYW5kbGVGaWxlVXBsb2FkRXJyb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdjb21wbGV0ZSc6IHNlbGYuaGFuZGxlRmlsZVVwbG9hZENvbXBsZXRlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZhYmxlLnN1YnNjcmliZShvYnNlcnZlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuLy8g5Y+R5biDL+e8lui+keWwj+ivtFxyXG5QdWJOb3ZlbC5wcm90b3R5cGUubGlzdGVuU3VibWl0RXZlbnQgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIHN1Ym1pdEJ0biA9ICQoJyNzdWJtaXQtYnRuJyk7XHJcbiAgICBzdWJtaXRCdG4uY2xpY2soZnVuY3Rpb24oKXtcclxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyAgICAgICAvLyDpmLvmraLpu5jorqTkuovku7ZcclxuICAgICAgICB2YXIgYnRuID0gJCh0aGlzKTtcclxuICAgICAgICB2YXIgbm92ZWxJZCA9IGJ0bi5hdHRyKCdkYXRhLW5vdmVsLWlkJyk7XHJcblxyXG4gICAgICAgIHZhciBuYW1lID0gJChcImlucHV0W25hbWU9J25hbWUnXVwiKS52YWwoKTtcclxuICAgICAgICB2YXIgY292ZXJfdXJsID0gJChcImlucHV0W25hbWU9J2NvdmVyX3VybCddXCIpLnZhbCgpO1xyXG4gICAgICAgIHZhciBjYXRlZ29yeSA9ICQoXCJzZWxlY3RbbmFtZT0nY2F0ZWdvcnknXVwiKS52YWwoKTtcclxuICAgICAgICB2YXIgdGFnID0gJCgnaW5wdXRbbmFtZT1cInRhZ1wiXTpjaGVja2VkJykudmFsKCk7XHJcbiAgICAgICAgdmFyIHByaWNlID0gJChcImlucHV0W25hbWU9J3ByaWNlJ11cIikudmFsKCk7XHJcbiAgICAgICAgdmFyIHByb2ZpbGUgPSB3aW5kb3cudWUuZ2V0Q29udGVudCgpO1xyXG5cclxuICAgICAgICB2YXIgdXJsID0gXCJcIjtcclxuICAgICAgICBpZihub3ZlbElkKXtcclxuICAgICAgICAgICAgdXJsID0gJy9hY2NvdW50L2VkaXRfbm92ZWwvJztcclxuICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgICAgIHVybCA9ICcvYWNjb3VudC9wdWJfbm92ZWwvJztcclxuICAgICAgICB9XHJcbiAgICAgICAgbXlhamF4LnBvc3Qoe1xyXG4gICAgICAgICAgICAndXJsJzogdXJsLFxyXG4gICAgICAgICAgICAnZGF0YSc6IHtcclxuICAgICAgICAgICAgICAgICduYW1lJzogbmFtZSxcclxuICAgICAgICAgICAgICAgICdjb3Zlcl91cmwnOiBjb3Zlcl91cmwsXHJcbiAgICAgICAgICAgICAgICAnY2F0ZWdvcnknOiBjYXRlZ29yeSxcclxuICAgICAgICAgICAgICAgICd0YWcnOiB0YWcsXHJcbiAgICAgICAgICAgICAgICAncHJvZmlsZSc6IHByb2ZpbGUsXHJcbiAgICAgICAgICAgICAgICAncHJpY2UnOiBwcmljZSxcclxuICAgICAgICAgICAgICAgICdub3ZlbF9pZCc6IG5vdmVsSWRcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbihyZXN1bHQpe1xyXG4gICAgICAgICAgICAgICAgaWYocmVzdWx0Wydjb2RlJ10gPT09IDIwMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKG5vdmVsSWQpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ+aBreWWnO+8jOWwj+ivtOe8lui+keaIkOWKn++8gSc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ+aBreWWnO+8jOWwj+ivtOWPkeW4g+aIkOWKn++8gSdcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgeGZ6YWxlcnQuYWxlcnRTdWNjZXNzKG1lc3NhZ2UsZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy9hY2NvdW50L25vdmVsX2xpc3QvJztcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG59O1xyXG5cclxuLy8g55uR5ZCs5piv5ZCm5YWN6LS55LiL5ouJ5qGGXHJcblB1Yk5vdmVsLnByb3RvdHlwZS5saXN0ZW5Jc0ZyZWVFdmVudCA9IGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgaXNGcmVlSW5wdXQgPSAkKFwic2VsZWN0W25hbWU9J2lzX2ZyZWUnXVwiKTtcclxuICAgIHZhciBwcmljZUlucHV0ID0gJChcImlucHV0W25hbWU9J3ByaWNlJ11cIik7XHJcbiAgICBpZihpc0ZyZWVJbnB1dC52YWwoKSA9PT0gJzEnKSB7XHJcbiAgICAgICAgcHJpY2VJbnB1dC5zaG93KCk7XHJcbiAgICB9XHJcbiAgICBpc0ZyZWVJbnB1dC5jaGFuZ2UoZnVuY3Rpb24oKXtcclxuICAgICAgICBpZigkKHRoaXMpLnZhbCgpID09PSAnMCcpIHtcclxuICAgICAgICAgICAgcHJpY2VJbnB1dC52YWwoMCk7XHJcbiAgICAgICAgICAgIHByaWNlSW5wdXQuaGlkZSgpO1xyXG4gICAgICAgIH0gZWxzZSBpZigkKHRoaXMpLnZhbCgpID09PSAnMScpIHtcclxuICAgICAgICAgICAgcHJpY2VJbnB1dC52YWwoMCk7XHJcbiAgICAgICAgICAgIHByaWNlSW5wdXQuc2hvdygpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcHJpY2VJbnB1dC5jaGFuZ2UoZnVuY3Rpb24oKXtcclxuICAgICAgICBpZigkKHRoaXMpLnZhbCgpID09PSAnMCcpe1xyXG4gICAgICAgICAgICBpc0ZyZWVJbnB1dC5jaGlsZHJlbigpLmVxKDApLnByb3AoXCJzZWxlY3RlZFwiLCAnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgJCh0aGlzKS5oaWRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vLyDliJ3lp4vljJZVRWRpdG9yXHJcblB1Yk5vdmVsLnByb3RvdHlwZS5pbml0VUVkaXRvciA9IGZ1bmN0aW9uKCl7XHJcbiAgICB3aW5kb3cudWUgPSBVRS5nZXRFZGl0b3IoXCJlZGl0b3JcIix7XHJcbiAgICAgICAgJ2luaXRpYWxGcmFtZUhlaWdodCc6IDQwMCxcclxuICAgICAgICAnc2VydmVyVXJsJzogJy91ZWRpdG9yL3VwbG9hZC8nLFxyXG4gICAgfSlcclxufTtcclxuXHJcbi8vIOWIneWni+WMluWIhuexu+WSjOagh+etvlxyXG5QdWJOb3ZlbC5wcm90b3R5cGUuaW5pdENhdGVnb3J5ID0gZnVuY3Rpb24oKXtcclxuICAgIHZhciBzZWxlY3QgPSAkKCcjY2F0ZWdvcnktZm9ybScpO1xyXG4gICAgdmFyIHJhZGlvR3JvdXAgPSAkKCcucmFkaW8tZ3JvdXAnKTtcclxuICAgIG15YWpheC5nZXQoe1xyXG4gICAgICAgICd1cmwnOiAnL2FjY291bnQvZ2V0X2NhdGVfbGlzdC8nLFxyXG4gICAgICAgICdzdWNjZXNzJzogZnVuY3Rpb24ocmVzdWx0KXtcclxuICAgICAgICAgICAgaWYocmVzdWx0Wydjb2RlJ10gPT09IDIwMCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2F0ZUxpc3QgPSByZXN1bHRbJ2RhdGEnXVsnY2F0ZV9saXN0J107XHJcbiAgICAgICAgICAgICAgICAvLyDliJ3lp4vljJbliIbnsbtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaT0wO2k8Y2F0ZUxpc3QubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0LmFwcGVuZCgnPG9wdGlvbiB2YWx1ZT1cIicrY2F0ZUxpc3RbaV0uaWQrJ1wiPicrY2F0ZUxpc3RbaV0ubmFtZSsnPC9vcHRpb24+Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyDliJ3lp4vljJbmoIfnrb5cclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaj0wO2o8Y2F0ZUxpc3RbMF1bJ3RhZ3MnXS5sZW5ndGg7aisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gJCgnPGxhYmVsIGNsYXNzPVwicmFkaW8taW5saW5lXCI+PC9sYWJlbD4nKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVkaW8gPSAkKCc8aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cInRhZ1wiIHZhbHVlPVwiJyArIGNhdGVMaXN0WzBdWyd0YWdzJ11bal0uaWQgKyAnXCI+Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuYXBwZW5kKHJlZGlvKTtcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbC5hcHBlbmQoJyAnICsgY2F0ZUxpc3RbMF1bJ3RhZ3MnXVtqXS5uYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICByYWRpb0dyb3VwLmFwcGVuZChsYWJlbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyDliIbnsbvmlLnlj5jml7bvvIznm7jlupTnmoTmoIfnrb7pmo/kuYvmlLnlj5hcclxuICAgICAgICAgICAgICAgIHNlbGVjdC5jaGFuZ2UoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByYWRpb0dyb3VwLmVtcHR5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNhdGVnb3J5X2lkID0gJCh0aGlzKS52YWwoKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGFncyA9IGNhdGVMaXN0W2NhdGVnb3J5X2lkLTFdWyd0YWdzJ107XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBqPTA7ajx0YWdzLmxlbmd0aDtqKyspe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSAkKCc8bGFiZWwgY2xhc3M9XCJyYWRpby1pbmxpbmVcIj48L2xhYmVsPicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVkaW8gPSAkKCc8aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cInRhZ1wiIHZhbHVlPVwiJyt0YWdzW2pdLmlkKydcIj4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwuYXBwZW5kKHJlZGlvKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwuYXBwZW5kKCcgJyt0YWdzW2pdLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByYWRpb0dyb3VwLmFwcGVuZChsYWJlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcblB1Yk5vdmVsLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbigpe1xyXG4gICAgLy8g57yp55Wl5Zu+5LiK5Lyg5Yiw5pys5ZywXHJcbiAgICB0aGlzLmxpc3RlblVwbG9hZEZpbGVFdmVudCgpO1xyXG4gICAgLy8g57yp55Wl5Zu+5LiK5Lyg5Yiw5LiD54mb5LqRXHJcbiAgICAvLyB0aGlzLmxpc3RlblFpbml1VXBsb2FkRmlsZUV2ZW50KCk7XHJcbiAgICB0aGlzLmluaXRVRWRpdG9yKCk7XHJcbiAgICB0aGlzLmxpc3RlblN1Ym1pdEV2ZW50KCk7XHJcbiAgICB0aGlzLmluaXRDYXRlZ29yeSgpO1xyXG4gICAgdGhpcy5saXN0ZW5Jc0ZyZWVFdmVudCgpO1xyXG59O1xyXG5cclxuJChmdW5jdGlvbigpe1xyXG4gICAgdmFyIHB1Yk5vdmVsID0gbmV3IFB1Yk5vdmVsKCk7XHJcbiAgICBwdWJOb3ZlbC5ydW4oKTtcclxuICAgIFB1Yk5vdmVsLnByb2dyZXNzR3JvdXAgPSAkKCcjcHJvZ3Jlc3MtZ3JvdXAnKTtcclxuICAgIFB1Yk5vdmVsLnByb2dyZXNzQmFyID0gJCgnLnByb2dyZXNzLWJhcicpO1xyXG59KTsiXX0=
